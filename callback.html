<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SMART · Instagram Authorization Complete</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fafafa;
      padding: 32px;
      max-width: 760px;
      margin: auto;
      color: #333;
    }

    h1 { font-size: 22px; margin-bottom: 8px; }
    h2 { font-size: 18px; margin-top: 28px; }
    p  { color: #555; line-height: 1.5; }

    .success {
      background: #e7f9dd;
      border: 1px solid #71d54c;
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
    }

    .box {
      border: 1px solid #ddd;
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
    }

    .account {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 10px;
    }

    .note {
      font-size: 13px;
      color: #777;
      margin-top: 8px;
    }
  </style>
</head>

<body>

<h1>SMART · Instagram Authorization Complete</h1>

<p>
  The user has successfully completed Meta login and approved SMART’s
  requested permissions.
</p>

<div class="success">
  ✔ Authorization successful — Meta OAuth flow completed
</div>

<p class="note">
  This page represents the post-login experience after Meta redirects
  the user back to SMART.
</p>

<!-- STEP 1 -->
<h2>Step 1 — OAuth Result</h2>
<div class="box" id="codeStatus">Checking authorization status…</div>

<p class="note">
  SMART receives an authorization <strong>code</strong> from Meta, which is
  exchanged server-to-server for an access token.
</p>

<!-- STEP 2 -->
<h2>Step 2 — Approved Permissions</h2>
<div class="box">
  <p>The user approved the following read-only permissions:</p>
  <ul style="font-size:14px;color:#555;">
    <li><strong>pages_show_list</strong> — list Facebook Pages the user manages</li>
    <li><strong>pages_read_engagement</strong> — verify Page ↔ Instagram connection</li>
    <li><strong>instagram_basic</strong> — read public Instagram posts</li>
  </ul>

  <p class="note">
    SMART cannot post content, read messages, manage ads, or access private data.
  </p>
</div>

<!-- STEP 3 -->
<h2>Step 3 — Connected Instagram Accounts</h2>
<div class="box" id="accountsContainer">
  <p class="note">Loading connected accounts…</p>
</div>

<p class="note">
  Accounts shown below are retrieved using <strong>pages_show_list</strong>
  and are mocked for Meta App Review.
</p>

<script>
  // Read OAuth redirect parameters
  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");

  const codeStatus = document.getElementById("codeStatus");
  const accountsContainer = document.getElementById("accountsContainer");

  if (code) {
    codeStatus.innerHTML =
      "<strong>OAuth code received.</strong><br />" +
      "This confirms the user explicitly approved Meta permissions.";
  } else {
    codeStatus.innerHTML =
      "<strong>No OAuth code found.</strong><br />" +
      "This page is intended to be reached after Meta login.";
  }

  // ---- MOCK ACCOUNTS FOR APP REVIEW ----
  const MOCK_ACCOUNTS = [
    { username: "smart_health_demo", page: "SMART Health Demo Page" },
    { username: "nutrition_creator_test", page: "Nutrition Creator Test Page" }
  ];

  accountsContainer.innerHTML = "";
  MOCK_ACCOUNTS.forEach(acct => {
    const div = document.createElement("div");
    div.className = "account";
    div.textContent = `@${acct.username} — ${acct.page}`;
    accountsContainer.appendChild(div);
  });
</script>

</body>
</html>